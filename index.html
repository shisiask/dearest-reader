<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>A Letter for Miss Annie</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400;1,600&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400;1,500&family=Great+Vibes&display=swap" rel="stylesheet">
<style>
  *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}

  html {
    -webkit-text-size-adjust: 100%;
    -webkit-tap-highlight-color: transparent;
  }

  body {
    min-height: 100vh;
    min-height: 100dvh;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    background: #3b2f2f;
    background-image:
      radial-gradient(ellipse at 30% 20%, rgba(139,109,82,0.3) 0%, transparent 60%),
      radial-gradient(ellipse at 70% 80%, rgba(94,68,50,0.25) 0%, transparent 50%);
    padding: 40px 20px;
    font-family: 'Cormorant Garamond', Georgia, serif;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
  }

  /* ====== ENVELOPE SCENE ====== */
  .envelope-scene {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    z-index: 100;
    background: #3b2f2f;
    background-image:
      radial-gradient(ellipse at 30% 20%, rgba(139,109,82,0.3) 0%, transparent 60%),
      radial-gradient(ellipse at 70% 80%, rgba(94,68,50,0.25) 0%, transparent 50%);
    transition: opacity 0.8s ease, visibility 0.8s ease;
    padding: 20px;
  }

  .envelope-scene.hidden {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
  }

  /* Floating particles */
  .particle {
    position: absolute;
    background: rgba(212,175,110,0.25);
    border-radius: 50%;
    animation: floatParticle var(--dur, 8s) ease-in-out infinite;
    animation-delay: var(--delay, 0s);
    will-change: transform;
  }

  @keyframes floatParticle {
    0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.2; }
    25% { transform: translate(var(--dx, 30px), var(--dy, -40px)) scale(1.3); opacity: 0.5; }
    50% { transform: translate(var(--dx2, -20px), var(--dy2, -80px)) scale(0.8); opacity: 0.3; }
    75% { transform: translate(var(--dx3, 15px), var(--dy3, -30px)) scale(1.1); opacity: 0.4; }
  }

  /* Envelope */
  .envelope-container {
    position: relative;
    width: min(340px, 85vw);
    height: min(220px, 55vw);
    cursor: pointer;
    animation: envelopeFloat 3s ease-in-out infinite;
    perspective: 800px;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
  }

  @keyframes envelopeFloat {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
  }

  /* Touch/tap pulse effect instead of hover */
  .envelope-container::after {
    content: '';
    position: absolute;
    inset: -15px;
    border-radius: 12px;
    border: 2px solid rgba(212,175,110,0);
    transition: border-color 0.3s, box-shadow 0.3s;
    pointer-events: none;
    z-index: 10;
  }

  .envelope-container.tapped::after {
    border-color: rgba(212,175,110,0.3);
    box-shadow: 0 0 30px rgba(212,175,110,0.15);
  }

  /* Tap ripple */
  .tap-ripple {
    position: absolute;
    border-radius: 50%;
    background: rgba(212,175,110,0.2);
    transform: scale(0);
    animation: rippleOut 0.6s ease-out forwards;
    pointer-events: none;
    z-index: 20;
  }

  @keyframes rippleOut {
    to { transform: scale(4); opacity: 0; }
  }

  .envelope-body {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 82%;
    background: linear-gradient(170deg, #e8d9b4 0%, #dcc89e 50%, #d4be8e 100%);
    border-radius: 4px;
    box-shadow:
      0 8px 30px rgba(0,0,0,0.35),
      0 2px 8px rgba(0,0,0,0.2),
      inset 0 1px 0 rgba(255,255,255,0.2);
    overflow: hidden;
  }

  .envelope-body::before {
    content: '';
    position: absolute;
    inset: 8px;
    border: 1px solid rgba(139,109,70,0.15);
    border-radius: 2px;
    pointer-events: none;
  }

  .envelope-body::after {
    content: '';
    position: absolute;
    inset: 0;
    background:
      radial-gradient(ellipse at 0% 100%, rgba(120,90,50,0.12) 0%, transparent 50%),
      radial-gradient(ellipse at 100% 100%, rgba(120,90,50,0.1) 0%, transparent 40%);
    pointer-events: none;
  }

  /* Inner paper peek */
  .envelope-paper {
    position: absolute;
    top: 12%;
    left: 6%;
    right: 6%;
    height: 64%;
    background: linear-gradient(180deg, #f5edd6 0%, #f0e6c8 100%);
    border-radius: 2px;
    z-index: 0;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    transform: translateY(0);
    transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  .envelope-paper.rising {
    transform: translateY(-45%);
  }

  .envelope-paper::before {
    content: '';
    position: absolute;
    top: 15%;
    left: 10%;
    right: 10%;
    height: 1px;
    background: repeating-linear-gradient(to right, rgba(120,90,50,0.15) 0px, rgba(120,90,50,0.15) 20px, transparent 20px, transparent 25px);
  }

  .envelope-paper::after {
    content: '';
    position: absolute;
    top: 25%;
    left: 10%;
    right: 25%;
    height: 1px;
    background: repeating-linear-gradient(to right, rgba(120,90,50,0.12) 0px, rgba(120,90,50,0.12) 30px, transparent 30px, transparent 35px);
  }

  /* Flap */
  .envelope-flap {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 60%;
    transform-origin: top center;
    transform-style: preserve-3d;
    transform: rotateX(0deg);
    z-index: 3;
  }

  .envelope-flap-face {
    width: 100%;
    height: 100%;
    background: linear-gradient(180deg, #d4be8e 0%, #c9b07a 100%);
    clip-path: polygon(0% 0%, 50% 75%, 100% 0%);
    position: relative;
    backface-visibility: hidden;
  }

  .envelope-flap-face::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg, transparent 20%, rgba(0,0,0,0.04) 100%);
    clip-path: polygon(0% 0%, 50% 75%, 100% 0%);
  }

  .envelope-inner-flap {
    position: absolute;
    top: 14%;
    left: 0;
    width: 100%;
    height: 46%;
    clip-path: polygon(0% 0%, 50% 60%, 100% 0%);
    background: linear-gradient(180deg, #c4a870, #bfa065);
    z-index: 1;
  }

  /* Wax seal on envelope */
  .envelope-seal {
    position: absolute;
    top: 38%;
    left: 50%;
    transform: translateX(-50%);
    width: min(65px, 18vw);
    height: min(65px, 18vw);
    background: radial-gradient(circle at 35% 35%, #c0392b, #922b21 40%, #7b241c 70%, #641e16);
    border-radius: 50%;
    box-shadow:
      0 3px 12px rgba(0,0,0,0.4),
      inset 0 2px 4px rgba(255,255,255,0.15),
      inset 0 -2px 5px rgba(0,0,0,0.3);
    z-index: 5;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.3s ease;
  }

  .envelope-seal::before {
    content: '‚ú¶';
    font-size: min(22px, 6vw);
    color: rgba(255,255,255,0.2);
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
  }

  .envelope-seal::after {
    content: '';
    position: absolute;
    inset: 5px;
    border: 1.5px solid rgba(255,255,255,0.1);
    border-radius: 50%;
  }

  /* Seal glow pulse for mobile (replaces hover) */
  .envelope-seal {
    animation: sealPulse 2s ease-in-out infinite;
  }

  @keyframes sealPulse {
    0%, 100% { box-shadow: 0 3px 12px rgba(0,0,0,0.4), inset 0 2px 4px rgba(255,255,255,0.15), inset 0 -2px 5px rgba(0,0,0,0.3), 0 0 0 0 rgba(192,57,43,0); }
    50% { box-shadow: 0 3px 12px rgba(0,0,0,0.4), inset 0 2px 4px rgba(255,255,255,0.15), inset 0 -2px 5px rgba(0,0,0,0.3), 0 0 20px 4px rgba(192,57,43,0.25); }
  }

  .envelope-seal.cracking {
    animation: sealCrack 0.5s ease-out forwards;
  }

  @keyframes sealCrack {
    0% { transform: translateX(-50%) scale(1); }
    30% { transform: translateX(-50%) scale(1.15); }
    60% { transform: translateX(-50%) scale(0.95); opacity: 0.8; }
    100% { transform: translateX(-50%) scale(0) rotate(180deg); opacity: 0; }
  }

  .seal-fragment {
    position: fixed;
    background: radial-gradient(circle, #922b21, #7b241c);
    border-radius: 2px;
    pointer-events: none;
    z-index: 200;
  }

  .envelope-flap.opening {
    animation: flapOpen 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.4s forwards;
  }

  @keyframes flapOpen {
    0% { transform: rotateX(0deg); }
    100% { transform: rotateX(180deg); }
  }

  /* Prompt text */
  .prompt-text {
    margin-top: min(35px, 6vw);
    font-family: 'Cormorant Garamond', Georgia, serif;
    font-size: min(18px, 4.2vw);
    font-style: italic;
    color: rgba(212,175,110,0.6);
    letter-spacing: 1.5px;
    animation: promptPulse 2.5s ease-in-out infinite;
    user-select: none;
    text-align: center;
    padding: 0 10px;
  }

  @keyframes promptPulse {
    0%, 100% { opacity: 0.4; }
    50% { opacity: 0.8; }
  }

  .prompt-text .quill {
    display: inline-block;
    animation: quillBob 1.5s ease-in-out infinite;
    margin-right: 6px;
  }

  @keyframes quillBob {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    50% { transform: translateY(-3px) rotate(5deg); }
  }

  .envelope-title {
    font-family: 'Great Vibes', cursive;
    font-size: min(28px, 7vw);
    color: rgba(212,175,110,0.7);
    margin-bottom: min(30px, 5vw);
    text-align: center;
    animation: fadeSlideIn 1.2s ease-out both;
    padding: 0 10px;
  }

  @keyframes fadeSlideIn {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* ====== LETTER STATE ====== */
  .letter-wrapper {
    position: relative;
    max-width: 680px;
    width: 100%;
    opacity: 0;
    transform: translateY(60px) scale(0.9);
    transition: opacity 1s ease, transform 1s ease;
  }

  .letter-wrapper.revealed {
    opacity: 1;
    transform: translateY(0) scale(1);
  }

  .wax-seal {
    position: absolute;
    top: -25px;
    right: min(50px, 8vw);
    width: min(80px, 16vw);
    height: min(80px, 16vw);
    background: radial-gradient(circle at 35% 35%, #c0392b, #922b21 40%, #7b241c 70%, #641e16);
    border-radius: 50%;
    box-shadow:
      0 4px 15px rgba(0,0,0,0.5),
      inset 0 2px 4px rgba(255,255,255,0.15),
      inset 0 -3px 6px rgba(0,0,0,0.3);
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transform: scale(1.4) rotate(-15deg);
  }

  .letter-wrapper.revealed .wax-seal {
    animation: sealDrop 0.6s ease-out 0.8s both;
  }

  @keyframes sealDrop {
    from { opacity: 0; transform: scale(1.4) rotate(-15deg); }
    to { opacity: 1; transform: scale(1) rotate(0deg); }
  }

  .wax-seal::before {
    content: '‚ú¶';
    font-size: min(28px, 5.5vw);
    color: rgba(255,255,255,0.2);
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
  }

  .wax-seal::after {
    content: '';
    position: absolute;
    inset: 5px;
    border: 1.5px solid rgba(255,255,255,0.1);
    border-radius: 50%;
  }

  .ribbon-left, .ribbon-right {
    position: absolute;
    top: -2px;
    width: min(40px, 8vw);
    height: min(50px, 10vw);
    z-index: 5;
    opacity: 0;
  }
  .letter-wrapper.revealed .ribbon-left,
  .letter-wrapper.revealed .ribbon-right {
    animation: fadeIn 0.5s ease-out 0.7s both;
  }
  .ribbon-left {
    right: calc(min(50px, 8vw) + min(35px, 7vw));
    background: linear-gradient(135deg, #c0392b, #a93226);
    transform: rotate(-15deg);
    clip-path: polygon(30% 0%, 100% 0%, 100% 100%, 50% 75%, 0% 100%);
  }
  .ribbon-right {
    right: min(30px, 5vw);
    background: linear-gradient(225deg, #c0392b, #a93226);
    transform: rotate(15deg);
    clip-path: polygon(0% 0%, 70% 0%, 100% 100%, 50% 75%, 0% 100%);
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .letter {
    position: relative;
    background:
      linear-gradient(180deg,
        #f5edd6 0%, #f0e6c8 15%, #ede0be 50%, #e8d9b4 85%, #e3d2aa 100%
      );
    padding: min(60px, 8vw) min(55px, 7vw) min(50px, 7vw);
    border-radius: 3px;
    box-shadow:
      0 2px 4px rgba(0,0,0,0.1),
      0 8px 25px rgba(0,0,0,0.25),
      0 20px 50px rgba(0,0,0,0.15),
      inset 0 0 80px rgba(160,130,90,0.12);
    overflow: hidden;
  }

  .letter::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image:
      repeating-linear-gradient(0deg, transparent, transparent 28px, rgba(160,130,80,0.04) 28px, rgba(160,130,80,0.04) 29px);
    pointer-events: none;
  }

  .letter::after {
    content: '';
    position: absolute;
    inset: 0;
    background:
      radial-gradient(ellipse at 0% 0%, rgba(139,109,70,0.15) 0%, transparent 40%),
      radial-gradient(ellipse at 100% 0%, rgba(139,109,70,0.12) 0%, transparent 35%),
      radial-gradient(ellipse at 0% 100%, rgba(139,109,70,0.18) 0%, transparent 40%),
      radial-gradient(ellipse at 100% 100%, rgba(139,109,70,0.2) 0%, transparent 45%);
    pointer-events: none;
  }

  .ornamental-border {
    position: absolute;
    inset: min(12px, 2.5vw);
    border: 1px solid rgba(139,109,70,0.25);
    border-radius: 2px;
    pointer-events: none;
  }
  .ornamental-border::before {
    content: '';
    position: absolute;
    inset: 4px;
    border: 0.5px solid rgba(139,109,70,0.12);
    border-radius: 1px;
  }

  .letter-content {
    position: relative;
    z-index: 2;
  }

  .header-ornament {
    text-align: center;
    margin-bottom: 10px;
    color: rgba(120,90,50,0.4);
    font-size: min(18px, 4vw);
    letter-spacing: min(12px, 2.5vw);
  }

  .letter-title {
    text-align: center;
    font-family: 'Great Vibes', cursive;
    font-size: min(22px, 5.2vw);
    color: #6b4e30;
    margin-bottom: 5px;
  }

  .addressee {
    text-align: center;
    font-family: 'Great Vibes', cursive;
    font-size: min(38px, 9vw);
    color: #5a3e22;
    margin-bottom: 8px;
    letter-spacing: 1px;
  }

  .divider {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    margin: 15px 0 min(30px, 5vw);
  }
  .divider .line {
    flex: 1;
    height: 0.5px;
    background: linear-gradient(to right, transparent, rgba(120,90,50,0.35), transparent);
  }
  .divider .ornament { color: rgba(120,90,50,0.45); font-size: 14px; }

  .salutation {
    font-family: 'Playfair Display', Georgia, serif;
    font-style: italic;
    font-size: min(19px, 4.5vw);
    color: #5a3e22;
    margin-bottom: min(22px, 4vw);
  }

  .body-paragraph {
    font-family: 'Cormorant Garamond', Georgia, serif;
    font-size: min(17.5px, 4.2vw);
    line-height: 1.85;
    color: #3e2b15;
    margin-bottom: min(20px, 4vw);
    text-align: justify;
    text-indent: 2em;
  }

  .body-paragraph em { font-style: italic; color: #5a3e22; }

  .closing-sentiment {
    font-family: 'Cormorant Garamond', Georgia, serif;
    font-weight: 500;
    font-size: min(17.5px, 4.2vw);
    line-height: 1.85;
    color: #3e2b15;
    margin: min(28px, 5vw) 0 10px;
    text-align: justify;
    text-indent: 2em;
  }

  .sign-off {
    margin-top: min(35px, 6vw);
    text-align: right;
  }

  .sign-off .yours {
    font-family: 'Cormorant Garamond', Georgia, serif;
    font-style: italic;
    font-size: min(17px, 4vw);
    color: #5a3e22;
    margin-bottom: 4px;
  }

  .sign-off .signature {
    font-family: 'Great Vibes', cursive;
    font-size: min(30px, 7vw);
    color: #4a3520;
    margin-top: 8px;
  }

  .postscript {
    margin-top: min(35px, 6vw);
    padding-top: 18px;
    border-top: 0.5px solid rgba(120,90,50,0.2);
    font-family: 'Cormorant Garamond', Georgia, serif;
    font-style: italic;
    font-size: min(16px, 3.8vw);
    line-height: 1.8;
    color: #5a3e22;
  }

  .postscript strong { font-weight: 600; font-style: normal; }

  .footer-ornament {
    text-align: center;
    margin-top: min(25px, 4vw);
    color: rgba(120,90,50,0.35);
    font-size: 16px;
    letter-spacing: 10px;
  }

  .drop-cap::first-letter {
    font-family: 'Playfair Display', Georgia, serif;
    float: left;
    font-size: min(58px, 13vw);
    line-height: 0.8;
    padding-right: 8px;
    padding-top: 6px;
    color: #5a3e22;
    font-weight: 700;
  }

  /* Ink writing animation */
  .ink-reveal {
    opacity: 0;
    transform: translateY(8px);
  }

  .ink-reveal.visible {
    animation: inkWrite 0.8s ease-out forwards;
  }

  @keyframes inkWrite {
    0% { opacity: 0; transform: translateY(8px); filter: blur(2px); }
    40% { filter: blur(0.5px); }
    100% { opacity: 1; transform: translateY(0); filter: blur(0); }
  }

  /* Touch glow effect for letter paragraphs (mobile) */
  .touch-glow {
    position: absolute;
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(212,175,110,0.12) 0%, transparent 70%);
    pointer-events: none;
    z-index: 3;
    transform: translate(-50%, -50%) scale(0);
    animation: glowPulse 0.8s ease-out forwards;
  }

  @keyframes glowPulse {
    0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(2.5); opacity: 0; }
  }

  /* Quill cursor (desktop only) */
  .quill-cursor {
    position: fixed;
    pointer-events: none;
    z-index: 200;
    opacity: 0;
    transition: opacity 0.3s;
    font-size: 24px;
    transform: rotate(-30deg) scaleX(-1);
  }

  .quill-cursor.active { opacity: 0.7; }

  /* Candle glow corners */
  .candle-glow {
    position: fixed;
    width: min(300px, 60vw);
    height: min(300px, 60vw);
    border-radius: 50%;
    pointer-events: none;
    z-index: 1;
    opacity: 0;
    transition: opacity 1.5s ease;
  }

  .candle-glow.active {
    opacity: 1;
    animation: candleFlicker 4s ease-in-out infinite;
  }

  .candle-glow.top-left {
    top: -50px;
    left: -50px;
    background: radial-gradient(circle, rgba(255,180,50,0.07) 0%, transparent 70%);
  }

  .candle-glow.bottom-right {
    bottom: -50px;
    right: -50px;
    background: radial-gradient(circle, rgba(255,180,50,0.05) 0%, transparent 70%);
  }

  @keyframes candleFlicker {
    0%, 100% { opacity: 0.8; transform: scale(1); }
    25% { opacity: 1; transform: scale(1.05); }
    50% { opacity: 0.7; transform: scale(0.97); }
    75% { opacity: 0.95; transform: scale(1.02); }
  }

  /* ====== MOBILE TOUCH SHIMMER on letter text ====== */
  .body-paragraph.shimmer,
  .closing-sentiment.shimmer,
  .salutation.shimmer {
    background: linear-gradient(90deg,
      transparent 0%,
      rgba(212,175,110,0.08) 45%,
      rgba(212,175,110,0.15) 50%,
      rgba(212,175,110,0.08) 55%,
      transparent 100%
    );
    background-size: 200% 100%;
    background-clip: text;
    -webkit-background-clip: text;
    animation: textShimmer 1s ease-out forwards;
  }

  @keyframes textShimmer {
    0% { background-position: 100% 0; }
    100% { background-position: -100% 0; }
  }

  /* Haptic visual feedback ring for mobile seal tap */
  .seal-tap-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 2px solid rgba(255,255,255,0.3);
    transform: translate(-50%, -50%) scale(1);
    animation: tapRing 0.6s ease-out forwards;
    pointer-events: none;
  }

  @keyframes tapRing {
    0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
  }

  /* ====== SMALL PHONE TWEAKS ====== */
  @media (max-width: 380px) {
    body { padding: 20px 10px; }
    .letter { padding: 35px 22px 30px; }
    .body-paragraph { font-size: 15px; line-height: 1.75; text-indent: 1.5em; }
    .closing-sentiment { font-size: 15px; line-height: 1.75; text-indent: 1.5em; }
    .salutation { font-size: 16px; }
    .addressee { font-size: 28px; }
    .letter-title { font-size: 17px; }
    .sign-off .signature { font-size: 24px; }
    .postscript { font-size: 14px; }
    .ornamental-border { inset: 8px; }
    .drop-cap::first-letter { font-size: 42px; }
    .wax-seal { width: 55px; height: 55px; top: -20px; right: 25px; }
    .wax-seal::before { font-size: 20px; }
    .ribbon-left { width: 28px; height: 36px; right: 58px; }
    .ribbon-right { width: 28px; height: 36px; right: 15px; }
  }

  /* Landscape phone */
  @media (max-height: 500px) and (orientation: landscape) {
    .envelope-scene { padding: 10px; }
    .envelope-container { width: 220px; height: 145px; }
    .envelope-title { font-size: 20px; margin-bottom: 12px; }
    .prompt-text { margin-top: 12px; font-size: 14px; }
  }
</style>
</head>
<body>

<div class="candle-glow top-left"></div>
<div class="candle-glow bottom-right"></div>
<div class="quill-cursor" id="quillCursor">ü™∂</div>

<!-- ====== ENVELOPE SCENE ====== -->
<div class="envelope-scene" id="envelopeScene">
  <div id="particles"></div>
  <div class="envelope-title">A Correspondence Awaits...</div>

  <div class="envelope-container" id="envelope" role="button" aria-label="Break the seal to open the letter">
    <div class="envelope-inner-flap"></div>
    <div class="envelope-flap" id="envelopeFlap">
      <div class="envelope-flap-face"></div>
    </div>
    <div class="envelope-body"></div>
    <div class="envelope-paper" id="envelopePaper"></div>
    <div class="envelope-seal" id="envelopeSeal"></div>
  </div>

  <div class="prompt-text">
    <span class="quill">ü™∂</span> Break the seal to read your letter
  </div>
</div>

<!-- ====== THE LETTER ====== -->
<div class="letter-wrapper" id="letterWrapper">
  <div class="ribbon-left"></div>
  <div class="ribbon-right"></div>
  <div class="wax-seal"></div>

  <div class="letter" id="letterBody">
    <div class="ornamental-border"></div>

    <div class="letter-content">
      <div class="header-ornament ink-reveal">‚ùß ‚ùß ‚ùß</div>
      <div class="letter-title ink-reveal">A Letter to the Esteemed</div>
      <div class="addressee ink-reveal">Miss Annie</div>

      <div class="divider ink-reveal">
        <span class="line"></span>
        <span class="ornament">‚ú¶</span>
        <span class="line"></span>
      </div>

      <div class="salutation ink-reveal">Dearest Reader,</div>

      <p class="body-paragraph drop-cap ink-reveal">
        It has come to this author's attention that far too much time has passed since we last spoke, and I must confess, the <em>ton</em> is far less interesting without your presence in my daily correspondences.
      </p>

      <p class="body-paragraph ink-reveal">
        Word has reached me of your continued pursuits and endeavors, and I must say, I am most impressed by your unwavering determination. While the season of life may present its challenges ‚Äî much like navigating a particularly crowded ballroom ‚Äî you have shown remarkable grace under pressure.
      </p>

      <p class="body-paragraph ink-reveal">
        Do continue to pursue your ambitions with the same fervor one might pursue a dance with the season's most eligible suitor. The world, much like society, often tries to convince us we must choose between being admired and being accomplished. But you, dear friend, prove daily that one can be both formidable <em>and</em> fabulous.
      </p>

      <p class="body-paragraph ink-reveal">
        Remember: diamonds are not created in comfort, but under pressure. And you, my dear, are absolutely <em>sparkling</em>.
      </p>

      <p class="closing-sentiment ink-reveal">
        May you continue to conquer whatever challenges lie before you with the confidence of a Bridgerton and the cunning of a Featherington. Though we have not spoken in some time, know that I am cheering for your victories from afar.
      </p>

      <div class="sign-off ink-reveal">
        <div class="yours">Yours in solidarity and admiration,</div>
        <div class="signature">Your Long-Lost Correspondent</div>
      </div>

      <div class="postscript ink-reveal">
        <strong>P.S.</strong> ‚Äî Do write back when you have a moment. I simply <em>must</em> hear of your latest triumphs.
      </div>

      <div class="footer-ornament ink-reveal">‚ùß ‚ùß ‚ùß</div>
    </div>
  </div>
</div>

<script>
(function() {
  // ---- Device detection ----
  const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

  // ---- Particles (fewer on mobile for performance) ----
  const particleCount = isTouchDevice ? 12 : 20;
  const particlesContainer = document.getElementById('particles');
  for (let i = 0; i < particleCount; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    p.style.left = Math.random() * 100 + '%';
    p.style.top = Math.random() * 100 + '%';
    p.style.setProperty('--dur', (6 + Math.random() * 6) + 's');
    p.style.setProperty('--delay', (Math.random() * 5) + 's');
    p.style.setProperty('--dx', (Math.random() * 60 - 30) + 'px');
    p.style.setProperty('--dy', (Math.random() * -80 - 20) + 'px');
    p.style.setProperty('--dx2', (Math.random() * 60 - 30) + 'px');
    p.style.setProperty('--dy2', (Math.random() * -100 - 20) + 'px');
    p.style.setProperty('--dx3', (Math.random() * 40 - 20) + 'px');
    p.style.setProperty('--dy3', (Math.random() * -50 - 10) + 'px');
    const size = (2 + Math.random() * 4) + 'px';
    p.style.width = size;
    p.style.height = size;
    particlesContainer.appendChild(p);
  }

  // ---- Elements ----
  const envelope = document.getElementById('envelope');
  const seal = document.getElementById('envelopeSeal');
  const flap = document.getElementById('envelopeFlap');
  const paper = document.getElementById('envelopePaper');
  const scene = document.getElementById('envelopeScene');
  const letterWrapper = document.getElementById('letterWrapper');
  const letterBody = document.getElementById('letterBody');
  const quillCursor = document.getElementById('quillCursor');
  const candleGlows = document.querySelectorAll('.candle-glow');
  let opened = false;

  // ---- Tap ripple on envelope (mobile) ----
  if (isTouchDevice) {
    envelope.addEventListener('touchstart', function(e) {
      const touch = e.touches[0];
      const rect = envelope.getBoundingClientRect();
      const ripple = document.createElement('div');
      ripple.className = 'tap-ripple';
      ripple.style.left = (touch.clientX - rect.left) + 'px';
      ripple.style.top = (touch.clientY - rect.top) + 'px';
      ripple.style.width = '40px';
      ripple.style.height = '40px';
      envelope.appendChild(ripple);
      ripple.addEventListener('animationend', () => ripple.remove());

      envelope.classList.add('tapped');
      setTimeout(() => envelope.classList.remove('tapped'), 300);
    }, { passive: true });
  }

  // ---- Seal fragments ----
  function createSealFragments() {
    const sealRect = seal.getBoundingClientRect();
    const cx = sealRect.left + sealRect.width / 2;
    const cy = sealRect.top + sealRect.height / 2;
    const fragCount = isTouchDevice ? 6 : 8;

    for (let i = 0; i < fragCount; i++) {
      const frag = document.createElement('div');
      frag.className = 'seal-fragment';
      frag.style.left = cx + 'px';
      frag.style.top = cy + 'px';
      frag.style.width = (4 + Math.random() * 10) + 'px';
      frag.style.height = (4 + Math.random() * 8) + 'px';
      document.body.appendChild(frag);

      const angle = (Math.PI * 2 / fragCount) * i + (Math.random() - 0.5) * 0.5;
      const dist = 40 + Math.random() * 60;
      const dx = Math.cos(angle) * dist;
      const dy = Math.sin(angle) * dist;
      const rotation = Math.random() * 360;

      frag.animate([
        { transform: 'translate(0, 0) rotate(0deg) scale(1)', opacity: 1 },
        { transform: `translate(${dx}px, ${dy + 30}px) rotate(${rotation}deg) scale(0.3)`, opacity: 0 }
      ], {
        duration: 600 + Math.random() * 300,
        easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)',
        fill: 'forwards'
      }).onfinish = () => frag.remove();
    }
  }

  // ---- Haptic feedback ----
  function vibrate(pattern) {
    if (navigator.vibrate) {
      navigator.vibrate(pattern);
    }
  }

  // ---- Paper sound ----
  function playPaperSound() {
    try {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();

      const crackDur = 0.12;
      const crackBuf = ctx.createBuffer(1, ctx.sampleRate * crackDur, ctx.sampleRate);
      const crackData = crackBuf.getChannelData(0);
      for (let i = 0; i < crackData.length; i++) {
        const env = 1 - i / crackData.length;
        crackData[i] = (Math.random() * 2 - 1) * env * env * 0.3;
      }
      const crackSrc = ctx.createBufferSource();
      crackSrc.buffer = crackBuf;
      const crackFilter = ctx.createBiquadFilter();
      crackFilter.type = 'bandpass';
      crackFilter.frequency.value = 3000;
      crackFilter.Q.value = 0.5;
      crackSrc.connect(crackFilter).connect(ctx.destination);
      crackSrc.start(ctx.currentTime);

      const paperDur = 0.6;
      const paperBuf = ctx.createBuffer(1, ctx.sampleRate * paperDur, ctx.sampleRate);
      const paperData = paperBuf.getChannelData(0);
      for (let i = 0; i < paperData.length; i++) {
        const t = i / paperData.length;
        paperData[i] = (Math.random() * 2 - 1) * Math.sin(t * Math.PI) * 0.15;
      }
      const paperSrc = ctx.createBufferSource();
      paperSrc.buffer = paperBuf;
      const paperFilter = ctx.createBiquadFilter();
      paperFilter.type = 'lowpass';
      paperFilter.frequency.value = 1200;
      paperSrc.connect(paperFilter).connect(ctx.destination);
      paperSrc.start(ctx.currentTime + 0.4);
    } catch(e) {}
  }

  // ---- Envelope open ----
  function openEnvelope() {
    if (opened) return;
    opened = true;

    // Haptic: short burst for seal break
    vibrate([30, 50, 20]);

    // Seal ring effect on mobile
    if (isTouchDevice) {
      const ring = document.createElement('div');
      ring.className = 'seal-tap-ring';
      seal.appendChild(ring);
      ring.addEventListener('animationend', () => ring.remove());
    }

    seal.classList.add('cracking');
    createSealFragments();
    playPaperSound();
    flap.classList.add('opening');

    setTimeout(function() {
      paper.classList.add('rising');
      vibrate(15); // soft vibrate for paper
    }, 800);

    setTimeout(function() {
      scene.classList.add('hidden');

      setTimeout(function() {
        letterWrapper.classList.add('revealed');
        candleGlows.forEach(g => g.classList.add('active'));

        const inkElements = document.querySelectorAll('.ink-reveal');
        inkElements.forEach(function(el, i) {
          setTimeout(() => el.classList.add('visible'), 400 + i * 250);
        });

        // Gentle haptic as letter fully appears
        setTimeout(() => vibrate(10), 500);
      }, 400);
    }, 1600);
  }

  envelope.addEventListener('click', openEnvelope);

  // ---- DESKTOP: Quill cursor ----
  if (!isTouchDevice) {
    letterWrapper.addEventListener('mouseenter', () => quillCursor.classList.add('active'));
    letterWrapper.addEventListener('mouseleave', () => quillCursor.classList.remove('active'));
    document.addEventListener('mousemove', function(e) {
      quillCursor.style.left = (e.clientX + 5) + 'px';
      quillCursor.style.top = (e.clientY - 28) + 'px';
    });
  } else {
    // Hide quill cursor entirely on touch devices
    quillCursor.style.display = 'none';
  }

  // ---- MOBILE: Touch glow + shimmer on paragraphs ----
  if (isTouchDevice) {
    letterBody.addEventListener('touchstart', function(e) {
      const touch = e.touches[0];
      const rect = letterBody.getBoundingClientRect();

      // Create glow at touch point
      const glow = document.createElement('div');
      glow.className = 'touch-glow';
      glow.style.left = (touch.clientX - rect.left) + 'px';
      glow.style.top = (touch.clientY - rect.top) + 'px';
      letterBody.appendChild(glow);
      glow.addEventListener('animationend', () => glow.remove());

      // Find the touched paragraph and add shimmer
      const target = document.elementFromPoint(touch.clientX, touch.clientY);
      if (target && (target.classList.contains('body-paragraph') ||
                     target.classList.contains('closing-sentiment') ||
                     target.classList.contains('salutation'))) {
        target.classList.remove('shimmer');
        // Force reflow
        void target.offsetWidth;
        target.classList.add('shimmer');
        target.addEventListener('animationend', function handler() {
          target.classList.remove('shimmer');
          target.removeEventListener('animationend', handler);
        });
      }
    }, { passive: true });
  }

  // ---- DESKTOP: Subtle paragraph hover glow ----
  if (!isTouchDevice) {
    const paragraphs = document.querySelectorAll('.body-paragraph, .closing-sentiment');
    paragraphs.forEach(p => {
      p.style.transition = 'text-shadow 0.4s ease';
      p.addEventListener('mouseenter', () => {
        p.style.textShadow = '0 0 20px rgba(212,175,110,0.08)';
      });
      p.addEventListener('mouseleave', () => {
        p.style.textShadow = 'none';
      });
    });
  }

})();
</script>

</body>
</html>